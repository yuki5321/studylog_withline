ここまでの開発お疲れ様でした！「AIメンター付き学習管理LIFFアプリ」の素晴らしいMVPが完成しましたね。
後から見返したり、他の人に共有したりするために、構成や機能をまとめた`README.md`を作成しました。

この内容をコピーして、プロジェクトのルートディレクトリに保存してください。

---

# 📝 学習記録アプリ：集中ログ MVP (AI Study Mentor)

LINEの中で動作する、高校生向けの学習時間管理・共有アプリです。タイマー機能に加え、Gemini AIによるモチベーションアップと、仲間とのランキング機能を備えています。

## 🚀 主な機能

### 1. ハイブリッド・タイマー

* **カウントアップ**: 勉強開始から終了までの時間を計測します。
* **カウントダウン**: 目標時間（分）を設定し、0になるまで追い込みをかけられます。0になると自動で停止します。

### 2. AIメンターによるフィードバック

* 学習終了時に、Googleの最新AI **Gemini 1.5 Flash** が、あなたの学習内容と集中度（🤩・😐・😴）に合わせて、情熱的な褒め言葉を生成し、LINEトークに送信します。

### 3. 学習履歴の可視化

* **合計学習時間**: アプリを開いた瞬間に、これまでの累計時間が表示されます。
* **目標達成率**: 目標を設定して学習した場合、終了時に「目標達成率（%）」を自動算出し、LINEへ通知します。

### 4. 仲間とのランキング

* スプレッドシートに蓄積された全ユーザーのデータを集計し、毎朝（7〜8時）に「昨日の学習時間ランキング」をLINE公式アカウントから一斉配信します。

### 5. 🆕 ネットワークエラー時の自動再送機能

* **オフライン対応**: 通信エラーで記録の送信に失敗した場合、LocalStorageに自動保存されます。
* **次回起動時に再送信**: アプリを次回開いた際に、未送信の記録があることを通知し、自動的に再送信を試みます。
* **信頼性の向上**: 電波の悪い場所でも学習記録を失わず、安心して使用できます。

### 6. 🆕 エラーログシステム（管理者向け）

* **自動エラー記録**: すべてのエラーがスプレッドシートの `ErrorLogs` シートに自動記録されます。
* **詳細情報**: タイムスタンプ、関数名、エラーメッセージ、スタックトレース、重要度を記録。
* **管理機能**: `getRecentErrors()` で最新エラーの確認、`cleanupOldErrorLogs()` で古いログの自動削除が可能。
* **重大エラーの検知**: CRITICAL レベルのエラーは特別にマークされ、コンソールに警告を出力。

### 7. 🆕 ダークモード対応

* **目の負担を軽減**: 夜間学習時に目に優しいダークテーマに切り替え可能。
* **ワンタッチ切替**: 画面右上の 🌙/☀️ ボタンで即座にテーマを変更。
* **設定の記憶**: LocalStorageにテーマ設定を保存し、次回起動時も同じテーマで表示。
* **スムーズなトランジション**: ライト/ダークモード間の切り替えが滑らかなアニメーションで実現。

### 8. 🆕 科目別アイコン・カラーコード

* **視覚的識別**: 各科目に専用のアイコン絵文字とカラーコードを設定。
  - 📖 現代の国語（ピンク系）
  - 📊 数学Ⅰ/A（ブルー系）
  - 💬 論理表現Ⅰ（グリーン系）
  - ⚛️ 物理基礎（パープル系）
  - 🧪 化学基礎（オレンジ系）
  - 🌱 生物基礎（グリーン系）
  - 🏛️ 歴史総合（ゴールド系）
  - その他各科目
* **ホバーエフェクト**: 科目ボタンにマウスを乗せると拡大し、選択しやすい。
* **直感的な操作**: アイコンで科目を素早く認識でき、学習記録がより楽しく。

### 9. 🆕 達成感アニメーション

* **紙吹雪エフェクト**: タイマー停止時に学習時間に応じた紙吹雪が画面に舞います。
* **段階的な演出**:
  - 5分以上: 基本の紙吹雪
  - 10分以上: 左右からの追加紙吹雪
  - 30分以上: 連続花火エフェクト
* **モチベーション向上**: 視覚的なお祝いで達成感を強化し、継続学習をサポート。

## 🛠 技術スタック

* **Frontend**: HTML5, CSS3, JavaScript (LIFF SDK v2)
* **Backend**: Google Apps Script (GAS)
* **Database**: Google Sheets (スプレッドシート)
* **AI**: Gemini 1.5 Flash API
* **Messaging**: LINE Messaging API (Broadcast / Push)

## 📂 ファイル構成

* `index.html`: LIFFアプリ本体。タイマー制御、LIFF初期化、GASへのデータ送信、ダークモード、アニメーション。
* `gas_code_updated.js`: 改善版GASコード（エラーログ機能付き）- **こちらを使用してください**
* `code.gs`: バックエンド処理（旧バージョン）
* `doPost`: 学習データの保存、履歴の集計、エラーハンドリング。
* `generateAiPraise`: Gemini APIとの連携。
* `sendDailyRanking`: ランキング集計とBroadcast配信。
* `logError`: エラー情報をErrorLogsシートに記録。



## ⚙️ セットアップ（管理者向け）

1. **LINE Developers**:
* Messaging APIチャネルとLIFFチャネルを作成。
* `liff.init({ liffId: "YOUR_LIFF_ID" })` にIDを設定。


2. **Google Apps Script**:
* `GEMINI_API_KEY` と `LINE_ACCESS_TOKEN` を設定。
* ウェブアプリとしてデプロイ（アクセス権限：全員）。


3. **トリガー設定**:
* `sendDailyRanking` 関数を「日付ベースのタイマー」で毎日朝に実行するよう設定。



---

## 📈 今後の展望（Next Steps）

### 実装済み機能 ✅
* ✅ ネットワークエラー時の自動再送機能
* ✅ エラーログ記録システム（管理者向け）
* ✅ ダークモード対応
* ✅ 科目別アイコン・カラーコード
* ✅ 達成感アニメーション（紙吹雪エフェクト）

### 検討中の機能 💡
* 科目別の学習比率を円グラフで表示
* 連続ログイン日数（継続記録）のカウント機能
* 特定の友達グループ内での限定ランキング機能
* 学習予定管理（今日の目標設定）
* 復習リマインダー機能
* 学習ノート記録
* データエクスポート機能（CSV/Excel）

---

## 🔧 最新アップデート情報（2026年2月18日）

### エラーハンドリング強化
- **再送機能**: 通信失敗時にLocalStorageで記録を保護し、次回起動時に自動再送
- **エラーログ**: すべてのエラーをスプレッドシートに記録（タイムスタンプ、重要度付き）

### UI/UX改善
- **ダークモード**: 夜間学習時の目の負担を軽減（🌙/☀️でワンタッチ切替）
- **科目カラーリング**: 各科目に専用アイコンと色を設定し、視覚的に識別しやすく
- **達成アニメーション**: タイマー停止時に学習時間に応じた紙吹雪エフェクト

### 管理機能追加
- `getRecentErrors()`: 最新エラーの確認
- `cleanupOldErrorLogs()`: 30日以上前のログを自動削除
- エラー重要度判定（CRITICAL/WARNING/INFO）

---

### 次にやってみたいことはありますか？

このREADMEをベースに、例えば「アイコン画像を作ってみたい」や「友達に紹介するためのランディングページを作りたい」など、次のステップがあればお手伝いします！